import{a as y}from"./chunk-YWKG5OBB.js";import{a as s}from"./chunk-E4HN7K4Y.js";import{a as C}from"./chunk-O2XFH626.js";import{runAsyncSynchronously as T}from"@iliad.dev/ts-utils";import{Hermes as g}from"@iliad.dev/hermes";var c=class h{constructor(e,t,r,n,a){C(this,"hermes");C(this,"client","axios");this.hermes=new g(e,s.mergeDefaultHermesOptions(a)).addBaseUrl(t),r&&this.hermes.addBaseHeaders({Authorization:`Bearer ${r}`}),n&&(this.client=n||this.client)}static createStrapiContext(e,t,r,n){return new h(e,t,r,void 0,n)}async getWithClient(e,t){e=e;let r;return this.client==="axios"?(r=await this.hermes.axios.get(e,t),r=r.data):r=await this.hermes.fetch(e,t),r}async getFullCollection(e,t="",r=this.hermes){t=s.sanitizeQuery(t);let n=[],a;{let{data:o,error:m}=await this.getCollection(e,1,25,t);if(m)return console.error(`Error fetching collection ${e}:`,m,{query:t}),{data:void 0,error:m};if(!o)return console.error("No data returned from Strapi"),{data:void 0,error:{message:"No data returned from Strapi",code:500}};a=o.meta,n=o.data}let p=s.indexArrayFromMeta(a).map(async o=>{let{data:m,error:l}=await this.getCollection(e,o,25,t);return l?(console.error(`Error fetching collection ${e}:`,l,{query:t}),{data:void 0,error:l}):m?m.data:(console.error("No data returned from Strapi"),{data:void 0,error:{message:"No data returned from Strapi",code:500}})});return(await Promise.all(p)).forEach(o=>{Array.isArray(o)&&(n=n.concat(o))}),await s.coerceData({meta:a,data:n},e)}async getEntryBySlug(e,t,r="",n=this.hermes){let a=s.sanitizeQuery(r,!1),i=`&filters[slug][$eq]=${t}`;a&&(i+=`&${a}`);let{data:p,error:d}=await this.getCollection(e,1,1,i);return d?(console.error(`Error fetching entry by slug ${e}/${t}:`,d,{query:i}),{data:void 0,error:d}):await s.coerceData(p,e,t,!0)}async getCollection(e,t=1,r=25,n="",a=this.hermes){let i=s.sanitizeQuery(n,!1),p=`?pagination[pageSize]=${r}&pagination[page]=${t}`;i&&(p+=`&${i}`);let{data:d,error:o}=await this.getWithClient(`${e}${p}`,{next:{tags:[e,"atlas::full-revalidation"]}});return o?(console.error(`Error fetching collection ${e}:`,o,{query:p}),{data:void 0,error:o}):await s.coerceData(d,e)}async getEntry(e,t,r="",n=this.hermes){r=s.sanitizeQuery(r);let{data:a,error:i}=await this.getWithClient(`${e}/${t}${r}`,{next:{tags:[e,"atlas::full-revalidation"]}});return i?(console.error(`Error fetching entry ${e}:`,i,{query:r}),{data:void 0,error:i}):await s.coerceData(a,e,t)}async getSingle(e,t="",r=this.hermes){t=s.sanitizeQuery(t);let{data:n,error:a}=await this.getWithClient(`${e}${t}`,{next:{tags:[e,"atlas::full-revalidation"]}});return a?(console.error(`Error fetching entry ${e}:`,a,{query:t}),{data:void 0,error:a}):await s.coerceData(n,e)}get Hermes(){return this.hermes}withContentTypes(e){let{data:t,error:r}=T(y,this.hermes,e);return this}static extractStrapiData(e){return s.extractStrapiData(e)}extractStrapiData(e){return s.extractStrapiData(e)}},I=c;export{I as a};
